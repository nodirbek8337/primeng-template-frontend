<div class="datatable-card card mt-1">
    <div class="card-body">
        <div class="header-content mb-3">
            <div class="header-title-content">
                <h4 *ngIf="tableTitle">{{ tableTitle }}</h4>
                <button *ngIf="hasRefreshBtn" pButton icon="pi pi-refresh" class="table-refresh-btn" (click)="triggerRefresh()"></button>
                <button 
                    *ngIf="hasClearFilterBtn"
                    pButton 
                    icon="pi pi-filter-slash" 
                    class="table-refresh-btn"
                    (click)="clearAllFilters()"
                    [disabled]="loading || isFilterEmpty()"
                ></button>
            </div>
            <button *ngIf="hasCreate" pButton icon="pi pi-plus" label="Add" (click)="triggerAdd()"></button>
        </div>

        <ng-content select="[filter]"></ng-content>

        <p-table
            [value]="value"
            [columns]="columnDefs"
            [paginator]="true"
            [rows]="rows"
            [totalRecords]="totalRecords"
            [rowsPerPageOptions]="rowsPerPageOptions"
            [loading]="loading"
            [lazy]="true"
            (onLazyLoad)="loadData($event)"
            (onRowClick)="handleRowClick($event)"
            dataKey="id"
        >
            <ng-template pTemplate="header" let-columns>
                <tr class="sort-headers">
                    <th *ngFor="let col of columns" [pSortableColumn]="col.sortable !== false ? col.field : null" class="sort-header">
                        {{ col.header }}
                        <p-sortIcon *ngIf="col.sortable !== false" [field]="col.field"></p-sortIcon>
                    </th>
                </tr>
                <tr class="filter-headers">
                    <th *ngFor="let col of columns" class="filter-header">
                        <input 
                            *ngIf="col.searchable !== false" 
                            pInputText 
                            type="text" 
                            class="w-100"
                            placeholder="Search {{ col.header }}"
                            [(ngModel)]="columnFilters[col.field]" 
                            (ngModelChange)="onColumnFilter($event, col.field)"
                        />
                    </th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-rowData let-columns="columns">
                <tr class="body-contents">
                    <td *ngFor="let col of columns">
                        {{ rowData[col.field] }}
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>
